</div>

## Симплектические методы

<div>
Эти методы сделаны специально для того чтобы решать задачи с которыми физика в играх и встречается. 
Они работают для систем, где нужно получить скорости и координаты. Для произвольных систем такие методы не подходят.

Если прочитать определение в википедии симплектических методов, то можно очень сильно удивиться от количества умных слов.
Симплектические методы -- это методы численного интегрирования, которые сохраняют объемы в фазовом пространстве.
Фазовое пространство для это просто пространство, где на одной оси у нас координата, а на другой скорость.
Вот это фазовое пространство для пружинки:

А вот это нет:



Что это и зачем. Я не знаю до конца в каком порядке все происходило но составил примерно такую картину. 
Есть теорема Лиувиля которая говорит, что если у нас есть система в которой энергия сохраняется, то объемы в фазовом пространстве сохраняются.

Т. е если взять несколько точек в фазовом пространстве, и посмотреть как они двигаются, то они будут двигаться так, что объемы будут сохраняться. Вот здесь например 4 точки с разными начальными условиями в системе с пружинкой и они двигаются по фазовым траекториям. 
Мы как будто следим одновременно за 4 пружинками и рисуем их графики. 
{% include /templates/include_sketch.html path="numerical_method/sketch/analitical_phase_spring.js" base_name="analitical_phase_spring" %}

И если мы посмотрим на объем который они занимают, то он будет сохраняться.
Об этом и говорит теорема Лиувиля (ну она говорит гораздо больше и умнее, но нам нужно только вот этот момент).

Так вот идея симплектических методов повторить следствие теоремы Лиувиля в численном методе. Если энергия сохраняется, то и объемы в фазовом пространстве сохраняются. И если мы будем использовать методы, которые сохраняют объемы, то мы лучше будем сохранять энергию. 
Хочу очень сильно подчеркнуть, что симплектические методы не сохраняют аналитическую энергию, Они сохраняют что-то похожее на нее. 
И это не всегда работает, но в большинстве случаев это лучше чем ничего.
Существуют методы которые способны полностью сохранять энергию, но они сложные и не всегда применимы на практике. 
Почему так: базовая идея -- сохранение фазового объема -- задача которая ограничивает траекторию решение сильнее чем сохранение энергии. и как следствие методы которые сохраняют фазовый объем работают лучше и ближе к аналитическому решению.
Есть научная статья в которой говорится, что нельзя создать численный метод который бы для любой системы сохранял энергию и фазовый объем, поэтому нам остается пользоваться тем что есть.

Давайте для примера посмотрим что происходит с фазовым объемом для явного и неявного метода в пружинке

{% include /templates/include_sketch.html path="numerical_method/sketch/forward_phase_spring.js" base_name="forward_phase_spring" %}
{% include /templates/include_sketch.html path="numerical_method/sketch/backward_phase_spring.js" base_name="backward_phase_spring" %}

Ну в принципе достаточно ожидаемые результаты. У явного метода росла энергия и здесь видно что и объем растет. У неявного наоборот все уменьшается.

<!-- 
Вот так выглядит фазовое пространство для пушки
{% include /templates/include_sketch.html path="numerical_method/sketch/forward_phase_canon.js" base_name="forward_phase_canon" %}
 -->
</div>

### Semi-implicit Euler

<div>
Самый простой и самый популярный симплектический метод -- это метод полуявного Эйлера. 

Его идея используется во многих физических движках. 

В явном виде он выглядит так
\begin{equation}
    \begin{split}
        &\dot{v}_{k+1} = \dot{v}_k + f(x_k, v_{k+1})\Delta t.
        &x_{k+1} = x_k + g(x_k, v_{k+1}),\\
    \end{split}
\end{equation}
Собственно он полуявный (полунеявный) тк в общем виде дифур скорости неявный, а дифур координаты явный.
Для того чтобы не иметь дело с неявным методом обычно полуявный метод рассматривают для систем в котором скорость зависит только от координаты.
Т.е. $f(x, v) = f(x)$.



Давайте на примерах. Вот что будет если просимулировать пружинку с помощью полуявного метода. 

{% include /templates/include_sketch.html path="numerical_method/sketch/symplectic_euler_spring.js" base_name="symplectic_euler_spring" %}
Пружинка получилась супер стабильная. Энергия осцилирует, но всегда возращается обратно и это очень круто. Потенциально мы можем симулировать такие системы вечно. 
Если посмотреть на фазовое пространство, то там тоже все хорошо. Объем сохраняется и это очень круто. 
Есть ошибка, но она не накапливается. А возвращается обратно.
{% include /templates/include_sketch.html path="numerical_method/sketch/symplectic_phase_spring.js" base_name="symplectic_phase_spring" %}

Вот еще пример того что сохранения фазового объема не сохраняет энергию. 

{% include /templates/include_sketch.html path="numerical_method/sketch/symplectic_euler_canon.js" base_name="symplectic_euler_canon" %}

Поскольку координата и скорость постоянно меняются, то для того чтобы показавать фазовое пространство я отцентрировал его в середине аналитического решения.

{% include /templates/include_sketch.html path="numerical_method/sketch/symplectic_phase_canon.js" base_name="symplectic_phase_canon" %}

Объем сохраняется, но энергия падает тк появляется ошибка в скорости и позиции которые накапливаются со временем. 
Тк решение не периодическое у нас нет шанса сбалансировать ошибку.


</div>

#### Анализ устойчивости

<div>

Если с прямым и обратным Эйлером все было понятно: есть уравнение системы, считаем его собственные значения и смотрим удовлетворяет ли они  условиям устойчивости. То с симплектическими методами все немного сложнее. Если в общем случае, то устойчивость симплектических методов определяется устойчивостью каждого уравнения системы. 
Если рассматривать системы вида 
\begin{equation}
    \begin{split}
        &\dot{v} = f(x) + g(v),\\
        &\dot{x} = v,\\
    \end{split}
\end{equation}

Для нас, как для создателей новых физических движков интересен следующий факт, что всякие осцилирующие или периодические системы условно устойчивы. Те мы можем подобрать такой шаг по времени, что решение не развалится.

Должно выполняться условие $(\Delta t * w) < 2$  где $w$ -- частота осцилляции. Если мы хотим визуализировать такие осциляции мы в любом случае должны требовать чтобы $\Delta t << w$.  Тк иначе мы просто не увидим этих колебаний. 

{% include /templates/image.html path='/numerical_method/stable_zone_symplectic.excalidraw.svg' %}

</div>

#### Анализ точности

<div>


У полуявного метода те же самые показатели точности, что и у явного и неявного. 


</div>

### Метод Верле

<div>




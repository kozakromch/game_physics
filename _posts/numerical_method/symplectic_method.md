</div>

## Симплектические методы

<div>
Эти методы сделаны специально для того чтобы решать задачи с которыми физика в играх и встречается. 
Они работают для систем, где нужно получить скорости и координаты. Для произвольных систем такие методы не подходят.

Если прочитать определение в википедии симплектических методов, то можно очень сильно удивиться от количества умных слов.
Симплектические методы -- это методы численного интегрирования, которые сохраняют объемы в фазовом пространстве.
Фазовое пространство для это просто пространство, где на одной оси у нас координата, а на другой скорость.
Вот это фазовое пространство для пружинки:

А вот это нет:



Что это и зачем. Я не знаю до конца в каком порядке все происходило но составил примерно такую картину. 
Есть теорема Лиувиля которая говорит, что если у нас есть система в которой энергия сохраняется, то объемы в фазовом пространстве сохраняются.

Т. е если взять несколько точек в фазовом пространстве, и посмотреть как они двигаются, то они будут двигаться так, что объемы будут сохраняться. Вот здесь например 4 точки с разными начальными условиями в системе с пружинкой и они двигаются по фазовым траекториям. 
Мы как будто следим одновременно за 4 пружинками и рисуем их графики. 
{% include /templates/include_sketch.html path="numerical_method/sketch/analitical_phase_spring.js" base_name="analitical_phase_spring" %}

И если мы посмотрим на объем который они занимают, то он будет сохраняться.
Об этом и говорит теорема Лиувиля (ну она говорит гораздо больше и умнее, но нам нужно только вот этот момент).

Так вот идея симплектических методов повторить следствие теоремы Лиувиля в численном методе. Если энергия сохраняется, то и объемы в фазовом пространстве сохраняются. И если мы будем использовать методы, которые сохраняют объемы, то мы лучше будем сохранять энергию. 
Хочу очень сильно подчеркнуть, что симплектические методы не сохраняют аналитическую энергию, Они сохраняют что-то похожее на нее. 
И это не всегда работает, но в большинстве случаев это лучше чем ничего.
Есть научная статья в которой говорится, что нельзя создать численный метод который бы для любой системы сохранял энергию, поэтому нам остается пользоваться тем что есть.


Давайте для примера посмотрим что происходит с фазовым объемом для явного и неявного метода в пружинке

{% include /templates/include_sketch.html path="numerical_method/sketch/forward_phase_spring.js" base_name="forward_phase_spring" %}
{% include /templates/include_sketch.html path="numerical_method/sketch/backward_phase_spring.js" base_name="backward_phase_spring" %}

Ну в принципе достаточно ожидаемые результаты. У явного метода росла энергия и здесь видно что и объем растет. У неявного наоборот все уменьшается.

<!-- 
Вот так выглядит фазовое пространство для пушки
{% include /templates/include_sketch.html path="numerical_method/sketch/forward_phase_canon.js" base_name="forward_phase_canon" %}
 -->
</div>

### Semi-implicit Euler

<div>
Самый простой и самый популярный симплектический метод -- это метод полуявного Эйлера. Он используется во многих физических движках. 
Если пока не понятна какая схема нужна для вашей задачи, а у вас есть скорости и координаты, то лучше всего начать с этого метода.
Он очень похож на обычный метод Эйлера, но с одним отличием.

Вот формула для обычного метода Эйлера
\begin{equation}
    \begin{split}
        &\dot{x}_{k+1} = \dot{x}_k + f(x_k)\Delta t.
        &x_{k+1} = x_k + \dot{x_k}\Delta t,\\
    \end{split}
\end{equation}

А вот для полуявного Эйлера
\begin{equation}
    \begin{split}
        &\dot{x}_{k+1} = \dot{x}_k + f(x_k)\Delta t.
        &x_{k+1} = x_k + \dot{x}_{k+1}\Delta t,\\
    \end{split}
\end{equation}
Разница в том, что скорость на следующем шаге считается по новому положению.
И пора симулировать наши модельные задачи 

{% include /templates/include_sketch.html path="numerical_method/sketch/symplectic_euler_spring.js" base_name="symplectic_euler_spring" %}
Пружинка получилась супер стабильная. Энергия осцилирует, но всегда возращается обратно и это очень круто. Потенциально мы можем симулировать такие системы вечно. 

Если посмотреть на фазовое пространство, то там тоже все хорошо. Объем сохраняется и это очень круто. 
Есть ошибка, но она не накапливается.
{% include /templates/include_sketch.html path="numerical_method/sketch/symplectic_phase_spring.js" base_name="symplectic_phase_spring" %}

Но вот пример того что сохранения фазового объема не сохраняет энергию. 

{% include /templates/include_sketch.html path="numerical_method/sketch/symplectic_euler_canon.js" base_name="symplectic_euler_canon" %}

Поскольку координата и скорость постоянно меняются, то для того чтобы показавать фазовое пространство я отцентрировал его в середине аналитического решения.

{% include /templates/include_sketch.html path="numerical_method/sketch/symplectic_phase_canon.js" base_name="symplectic_phase_canon" %}

Объем сохраняется, но энергия падает тк появляется ошибка в скорости и позиции которые накапливаются со временем. 
Тк решение не периодическое у нас нет шанса сбалансировать ошибку.


</div>

#### Анализ устойчивости

<div>


{% include /templates/image.html path='/numerical_method/stable_zone_symplectic.excalidraw.svg' %}


</div>

### Метод Верле

<div>



